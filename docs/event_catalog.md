# Complete Event Catalog

This document catalogs all WebSocket events emitted by the Gradient Bang game server during gameplay, with typical payloads showing all fields.

## Event Metadata

- Every event written to the audit log includes the standard envelope fields (`timestamp`, `direction`, `event`, `payload`, `sender`, `receiver`, `sector`, `meta`).
- Starting with the corporation integration (Phase 5), events also record an optional `corporation_id`. The event dispatcher infers this automatically for corp-specific activity, and the value is surfaced both in `event-log.jsonl` and through the `event.query` API filter.
- Earlier log entries (pre-Phase 5) simply omit `corporation_id`; consumers should treat the field as optional.
- **Ship credits vs. player credits:** As of November 2025, liquid credits live on the ship record. Historical payload examples that reference `player.credits_on_hand` have been updated in production to use `ship.credits`. When reviewing legacy logs you may still encounter the older field name.

## System Events

### error
**When emitted:** When an RPC request fails and the handler emits an error notification for the requesting player
**Who receives it:** Only the character whose request failed (character_filter)
**Source:** Helper `emit_error_event` (`game-server/api/utils.py`)

**Payload example:**
```json
{
  "endpoint": "move",
  "error": "Invalid move",
  "source": {
    "type": "rpc",
    "method": "move",
    "request_id": "req-error",
    "timestamp": "2025-10-15T18:42:03.000Z"
  }
}
```

**Notes:**
- Handlers raise `HTTPException` and emit this event before the RPC response is returned, so clients receive both the `error` event and an `ok: false` frame.
- The `source.timestamp` field is generated when the event is emitted and uses UTC ISO-8601 format.

### leaderboard.resources *(RPC)*
**When invoked:** Any time a client queries the wealth leaderboard via the `leaderboard.resources` endpoint or tool.
**Who receives it:** Only the caller. This endpoint does **not** emit a follow-up event; the entire leaderboard payload arrives in the RPC response.
**Source:** `/game-server/api/leaderboard_resources.py`

**Response example:**
```json
{
  "schema_version": 1,
  "as_of": "2025-11-06T04:15:12.345123+00:00",
  "sector_count": 1500,
  "players": [
    {
      "rank": 1,
      "character_id": "d0c9...e55b2",
      "name": "Admiral Jones",
      "bank_credits": 10000,
      "ship_credits": 25000,
      "ship_trade_in_value": 10000,
      "garrison_fighter_value": 500,
      "sectors_visited": 45,
      "exploration_percent": 3.0,
      "total_resources": 45500
    }
  ],
  "corporations": [
    {
      "rank": 1,
      "corp_id": "ff1a...4e49",
      "name": "Fleet Explorers",
      "member_count": 3,
      "corp_ship_count": 1,
      "corp_ship_credits": 20000,
      "corp_ship_trade_in_value": 25000,
      "member_total_resources": 120000,
      "total_resources": 165000
    }
  ]
}
```

**Notes:**
- Data is generated by `scripts/rebuild_leaderboard.py`, which reads the world-data files offline and writes `world-data/leaderboard_resources.json`.
- The RPC simply reads that snapshot (with a small in-process cache) and never broadcasts an event, so consumers must inspect the RPC result directly.
- Passing `force_refresh=true` skips the cache and reloads the latest on-disk snapshot.

## Combat Events

### combat.started *(removed October 7, 2025)*
**Status:** No longer emitted. Clients should treat the first `combat.round_waiting` event as confirmation that combat has begun.
**Previous payload:** Legacy dictionary of participants that included `max_fighters`/`max_shields` fields.

### combat.round_waiting
**When emitted:** When a combat round begins and is waiting for player actions, or when a character joins a sector that already has active combat
**Who receives it:** All character participants in the combat (character_filter)
**Source:** `/game-server/combat/callbacks.py:91` (round transitions), `game-server/api/join.py` (join correlation), and `game-server/api/move.py` (move arrival correlation)

**Payload example:** *(participants_map removed October 7, 2025)*
```json
{
  "combat_id": "a3f2b9c1d4e5f6",
  "sector": {"id": 42},
  "round": 1,
  "initiator": "trader",
  "current_time": "2025-10-07T14:25:00.000Z",
  "deadline": "2025-10-07T14:30:00.000Z",
  "participants": [
    {
      "created_at": "2025-10-07T12:00:00.000Z",
      "name": "trader",
      "player_type": "human",
      "ship": {
        "ship_type": "kestrel_courier",
        "ship_name": "Kestrel Courier",
        "shield_integrity": 85.0,
        "shield_damage": null,
        "fighter_loss": null
      }
    },
    {
      "created_at": "2025-10-07T11:30:00.000Z",
      "name": "pirate",
      "player_type": "human",
      "ship": {
        "ship_type": "sparrow_scout",
        "ship_name": "Sparrow Scout",
        "shield_integrity": 100.0,
        "shield_damage": null,
        "fighter_loss": null
      }
    }
  ],
  "garrison": {
    "owner_name": "defender",
    "fighters": 30,
    "fighter_loss": null,
    "mode": "offensive",
    "toll_amount": 0,
    "deployed_at": "2025-10-07T10:00:00.000Z"
  },
  "ship": {
    "ship_type": "kestrel_courier",
    "ship_name": "Kestrel Courier",
    "cargo": {
      "quantum_foam": 45,
      "retro_organics": 10,
      "neuro_symbolics": 5
    },
    "cargo_capacity": 120,
    "empty_holds": 60,
    "warp_power": 37,
    "warp_power_capacity": 50,
    "shields": 120,
    "max_shields": 150,
    "fighters": 45,
    "max_fighters": 50
  }
}
```

**Notes:**
- The opening round includes an `initiator` field identifying who triggered the encounter; subsequent rounds omit the field.
- Join-triggered and move-triggered emissions attach a `source` derived from their respective RPC request so clients can correlate the event to login or travel.
- `ship` contains the same structure as other status-bearing events (`status.update`, `movement.complete`) but only for the receiving character. Other combatants see summary data (shield percentages, losses).
- `ship.empty_holds` is a calculated field (cargo_capacity - sum(cargo)) included only in the viewer's own ship status, never in opponent views.
- Garrisons now expose `owner_name` and omit `toll_balance` for privacy.

### combat.round_resolved
**When emitted:** When a combat round is resolved and damage is calculated
**Who receives it:** All current participants plus recently fled characters (character_filter)
**Source:** `/game-server/combat/callbacks.py:197`

**Payload example:**
```json
{
  "combat_id": "a3f2b9c1d4e5f6",
  "sector": {"id": 42},
  "round": 2,
  "participants": [
    {
      "created_at": "2025-10-07T12:00:00.000Z",
      "name": "trader",
      "player_type": "human",
      "ship": {
        "ship_type": "kestrel_courier",
        "ship_name": "Kestrel Courier",
        "shield_integrity": 70.0,
        "shield_damage": -15.0,
        "fighter_loss": 5
      }
    },
    {
      "created_at": "2025-10-07T11:30:00.000Z",
      "name": "pirate",
      "player_type": "human",
      "ship": {
        "ship_type": "sparrow_scout",
        "ship_name": "Sparrow Scout",
        "shield_integrity": 95.0,
        "shield_damage": -5.0,
        "fighter_loss": 2
      }
    }
  ],
  "garrison": {
    "owner_name": "defender",
    "fighters": 25,
    "fighter_loss": 5,
    "mode": "offensive",
    "toll_amount": 0,
    "deployed_at": "2025-10-07T10:00:00.000Z"
  },
  "ship": {
    "ship_type": "kestrel_courier",
    "ship_name": "Kestrel Courier",
    "cargo": {
      "quantum_foam": 40,
      "retro_organics": 10,
      "neuro_symbolics": 5
    },
    "cargo_capacity": 120,
    "empty_holds": 65,
    "warp_power": 35,
    "warp_power_capacity": 50,
    "shields": 80,
    "max_shields": 150,
    "fighters": 42,
    "max_fighters": 50
  }
}
```

**Notes:**
- `ship` mirrors the status payload for the viewing character; deltas for opponents remain percentage-based.
- `garrison` remains a singular object even when present alongside character participants.

### combat.ended
**When emitted:** When combat concludes (all opponents destroyed, all fled, or timeout)
**Who receives it:** All remaining participants (character_filter). Fled characters receive their own separate combat.ended event immediately upon fleeing.
**Source:** `/game-server/combat/callbacks.py:359` (main) and `/game-server/combat/callbacks.py:289` (fled character version)

**Payload example (for remaining participants):**
```json
{
  "combat_id": "a3f2b9c1d4e5f6",
  "sector": {"id": 42},
  "participants": [
    {
      "created_at": "2025-10-07T12:00:00.000Z",
      "name": "trader",
      "player_type": "human",
      "ship": {
        "ship_type": "kestrel_courier",
        "ship_name": "Kestrel Courier",
        "shield_integrity": 65.0,
        "shield_damage": -10.0,
        "fighter_loss": 8
      }
    },
    {
      "created_at": "2025-10-07T11:30:00.000Z",
      "name": "pirate",
      "player_type": "human",
      "ship": {
        "ship_type": "sparrow_scout",
        "ship_name": "Pirate's Revenge",
        "shield_integrity": 0.0,
        "shield_damage": -100.0,
        "fighter_loss": 50
      }
    }
  ],
  "garrison": null,
  "salvage": [
    {
      "salvage_id": "salv_abc123",
      "sector_id": 42,
      "cargo": {
        "quantum_foam": 20,
        "retro_organics": 15,
        "neuro_symbolics": 10
      },
      "scrap": 50,
      "source": {
        "ship_name": "Pirate's Revenge",
        "ship_type": "sparrow_scout"
      }
    }
  ],
  "logs": [],
  "ship": {
    "ship_type": "kestrel_courier",
    "ship_name": "Kestrel Courier",
    "cargo": {
      "quantum_foam": 38,
      "retro_organics": 10,
      "neuro_symbolics": 5
    },
    "cargo_capacity": 120,
    "empty_holds": 67,
    "warp_power": 33,
    "warp_power_capacity": 50,
    "shields": 65,
    "max_shields": 150,
    "fighters": 42,
    "max_fighters": 50
  }
}
```

**Notes:**
- Salvage containers include the defeated ship's public metadata; no victor IDs or credit totals leak.
- The recipient's own `ship` block is included with full fighter/shield counts.

**Payload example (for fled character):**
```json
{
  "combat_id": "a3f2b9c1d4e5f6",
  "sector": {"id": 42},
  "result": "fled",
  "round": 3,
  "fled_to_sector": 43,
  "salvage": []
}
```

### combat.action_accepted
**When emitted:** After a combat action is accepted for processing.
**Who receives it:** Only the character who submitted the action (character_filter).
**Source:** `/game-server/api/combat_action.py`

**Payload example:**
```json
{
  "source": {
    "type": "rpc",
    "method": "combat.action",
    "request_id": "req-combat-001",
    "timestamp": "2025-10-16T18:05:42.312345+00:00"
  },
  "combat_id": "a3f2b9c1d4e5f6",
  "round": 2,
  "action": "pay",
  "round_resolved": true,
  "pay_processed": true
}
```

**Notes:**
- `round_resolved` indicates whether the submitted action immediately completed the round; follow-up `combat.round_resolved` events carry the full outcome details.
- `pay_processed` is present only for `pay` actions and reports whether the toll payment succeeded (failed payments include a `message` field explaining the fallback).
- `target_id`, `commit`, or `destination_sector` appear when relevant to the submitted action.

## Garrison Events

### garrison.deployed
**When emitted:** When a character leaves fighters behind to form or reinforce a garrison.
**Who receives it:** Only the deploying character (character_filter).
**Source:** `/game-server/api/combat_leave_fighters.py`

**Payload example:**
```json
{
  "source": {
    "type": "rpc",
    "method": "combat.leave_fighters",
    "request_id": "req-garrison-01",
    "timestamp": "2025-10-16T18:12:03.102938+00:00"
  },
  "sector": {"id": 5},
  "garrison": {
    "owner_name": "khk_aggressive",
    "fighters": 20,
    "mode": "defensive",
    "toll_amount": 0,
    "deployed_at": "2025-10-16T18:12:03.102938+00:00",
    "is_friendly": true
  },
  "fighters_remaining": 103
}
```

**Notes:**
- `fighters_remaining` reflects the deployer's fighters still aboard their ship after the transfer.
- The `garrison` block uses the same structure exposed in `sector.update` for friendly players; `is_friendly` appears when the viewer owns the garrison.

### garrison.collected
**When emitted:** When a character retrieves fighters (and any toll balance) from their garrison.
**Who receives it:** Only the collecting character (character_filter).
**Source:** `/game-server/api/combat_collect_fighters.py`

**Payload example:**
```json
{
  "source": {
    "type": "rpc",
    "method": "combat.collect_fighters",
    "request_id": "req-garrison-collect-07",
    "timestamp": "2025-10-16T18:15:44.552190+00:00"
  },
  "sector": {"id": 5},
  "credits_collected": 46,
  "garrison": {
    "owner_name": "toll_owner",
    "fighters": 15,
    "mode": "toll",
    "toll_amount": 25,
    "deployed_at": "2025-10-15T21:10:00.000000+00:00",
    "is_friendly": true
  },
  "fighters_on_ship": 135
}
```

**Notes:**
- When all stationed fighters are collected, `garrison` is `null` because the structure no longer exists.
- The toll balance is added to the player's credits and reported in `credits_collected`.

### garrison.mode_changed
**When emitted:** When a character updates their garrison's mode or toll amount.
**Who receives it:** Only the character who changed the mode (character_filter).
**Source:** `/game-server/api/combat_set_garrison_mode.py`

**Payload example:**
```json
{
  "source": {
    "type": "rpc",
    "method": "combat.set_garrison_mode",
    "request_id": "req-garrison-mode-04",
    "timestamp": "2025-10-16T18:18:09.223517+00:00"
  },
  "sector": {"id": 5},
  "garrison": {
    "owner_name": "khk_aggressive",
    "fighters": 15,
    "mode": "toll",
    "toll_amount": 30,
    "deployed_at": "2025-10-16T18:12:03.102938+00:00",
    "is_friendly": true
  }
}
```

**Notes:**
- Switching out of `toll` mode clears any accumulated toll balance; the payload reflects the post-update configuration.
- Clients should update their UI based on this event rather than the RPC response.

## Salvage Events

### salvage.collected
**When emitted:** When a character successfully claims salvage from a wreck.
**Who receives it:** Only the collecting character (character_filter - private event).
**Source:** `/game-server/api/salvage_collect.py`

**Payload example:**
```json
{
  "action": "collected",
  "salvage_details": {
    "salvage_id": "salv_ed5c1f",
    "collected": {
      "cargo": {"quantum_foam": 5},
      "credits": 12
    },
    "remaining": {
      "cargo": {},
      "scrap": 0
    },
    "fully_collected": true
  },
  "sector": {"id": 5},
  "timestamp": "2025-10-19T03:21:55.019Z",
  "source": {
    "type": "rpc",
    "method": "salvage.collect",
    "request_id": "req-salvage-11",
    "timestamp": "2025-10-16T18:21:55.019384+00:00"
  }
}
```

**Notes:**
- **Private event:** Only sent to collector (no actor field needed).
- **Privacy:** No final cargo/credit balances included. Character receives `status.update` event with updated state.
- **Partial collection:** If `fully_collected` is false, remaining items stay in salvage for others to collect.
- Unknown commodities are converted to `neuro_symbolics` by the server before collection.

### salvage.created
**When emitted:** Whenever a player dumps cargo and a new salvage container is spawned in their sector.
**Who receives it:** Only the dumping character receives the `salvage.created` confirmation (private event); everyone in the sector receives a separate `sector.update` showing the new salvage list.
**Source:** `/game-server/api/dump_cargo.py`

**Payload example:**
```json
{
  "action": "dumped",
  "salvage_details": {
    "salvage_id": "salv_e3a45c",
    "cargo": {"retro_organics": 40},
    "scrap": 0,
    "credits": 0,
    "expires_at": "2025-10-19T03:29:15.926Z"
  },
  "sector": {"id": 12},
  "timestamp": "2025-10-19T03:14:15.926Z",
  "source": {
    "type": "rpc",
    "method": "dump_cargo",
    "request_id": "req-dump-07",
    "timestamp": "2025-10-19T03:14:15.926Z"
  }
}
```

**Notes:**
- **Private event:** Only sent to dumper (no actor field needed).
- **Combat salvage:** When ships are destroyed in combat, salvage appears in `combat.ended` event (not as separate `salvage.created`).
- Salvage containers expire automatically after 15 minutes; `sector.update` removes expired containers.

## Movement Events

### course.plot
**When emitted:** When the `plot_course` RPC succeeds in finding a path
**Who receives it:** Only the requesting character (character_filter)
**Source:** `/game-server/api/plot_course.py`

**Payload example:**
```json
{
  "source": {
    "type": "rpc",
    "method": "plot_course",
    "request_id": "req-plot-42",
    "timestamp": "2025-10-16T16:05:00.000Z"
  },
  "from_sector": 1000,
  "to_sector": 1307,
  "path": [1000, 1203, 962, 1307],
  "distance": 3
}
```

**Notes:**
- Clients should listen for this event to receive the calculated path; the RPC response now returns only `{success: true}`.
- `request_id` allows correlating the event back to the initiating `plot_course` frame.

### path.region
**When emitted:** When the `path_with_region` RPC generates a path plus surrounding sector context
**Who receives it:** Only the requesting character (character_filter)
**Source:** `/game-server/api/path_with_region.py`

**Payload example:**
```json
{
  "path": [0, 1, 2],
  "distance": 2,
  "sectors": [
    {"sector_id": 0, "visited": true, "on_path": true},
    {"sector_id": 1, "visited": true, "on_path": true, "last_visited": "2025-10-16T16:00:00.000Z"},
    {"sector_id": 3, "visited": true, "on_path": false, "hops_from_path": 1}
  ],
  "total_sectors": 3,
  "known_sectors": 3,
  "unknown_sectors": 0,
  "source": {
    "type": "rpc",
    "method": "path_with_region",
    "request_id": "req-path-9",
    "timestamp": "2025-10-16T16:14:00.000Z"
  }
}
```

**Notes:**
- Returned sectors include both on-path nodes and nearby visited sectors up to `region_hops`.
- Unknown path nodes are included with minimal metadata so clients can render the full route even without prior visits.

### movement.complete
**When emitted:** When a character exits hyperspace and arrives at destination
**Who receives it:** The moving character only (character_filter)
**Source:** `/game-server/api/move.py:180`

**Payload example:**
```json
{
  "ship": {
    "ship_type": "kestrel_courier",
    "ship_name": "Kestrel Courier",
    "cargo": {
      "quantum_foam": 50,
      "retro_organics": 30,
      "neuro_symbolics": 20
    },
    "cargo_capacity": 100,
    "empty_holds": 0,
    "warp_power": 47,
    "warp_power_capacity": 50,
    "shields": 85,
    "max_shields": 100,
    "fighters": 45,
    "max_fighters": 50,
    "credits": 15000
  },
  "player": {
    "created_at": "2025-10-07T12:00:00.000Z",
    "last_active": "2025-10-07T14:25:30.000Z",
    "id": "trader",
    "name": "trader",
    "credits_in_bank": 0
  },
  "first_visit": true,
  "sector": {
    "id": 43,
    "adjacent_sectors": [42, 44, 50, 51],
    "port": {
      "code": "BSB",
      "prices": {
        "quantum_foam": {"buy_price": null, "sell_price": 12},
        "retro_organics": {"buy_price": 18, "sell_price": null},
        "neuro_symbolics": {"buy_price": null, "sell_price": 25}
      },
      "stock": {
        "quantum_foam": 500,
        "retro_organics": 300,
        "neuro_symbolics": 200
      },
      "observed_at": null
    },
    "players": [
      {
        "created_at": "2025-10-07T11:00:00.000Z",
        "name": "merchant",
        "player_type": "human",
        "ship": {
          "ship_type": "atlas_freighter",
          "ship_name": "Atlas Freighter"
        }
      }
    ],
    "garrison": null,
    "salvage": []
  }
}
```

**Notes:**
- `first_visit` is `true` the first time the mover enters a sector and `false` on revisits.

### map.knowledge
**When emitted:** When a character invokes the `my_map` RPC to retrieve their stored map knowledge
**Who receives it:** Only the requesting character (character_filter)
**Source:** `/game-server/api/my_map.py`

**Payload example:**
```json
{
  "character_id": "explorer",
  "sector": 12,
  "total_sectors_visited": 7,
  "sectors_visited": {
    "0": {"sector_id": 0, "last_visited": "2025-10-16T15:30:00.000Z"},
    "12": {"sector_id": 12, "last_visited": "2025-10-16T15:45:00.000Z"}
  },
  "ship_config": {
    "ship_type": "kestrel_courier",
    "ship_name": "Kestrel Courier",
    "cargo": {"quantum_foam": 40, "retro_organics": 10, "neuro_symbolics": 5}
  },
  "credits": 1180,
  "source": {
    "type": "rpc",
    "method": "my_map",
    "request_id": "req-map-42",
    "timestamp": "2025-10-16T15:45:02.000Z"
  }
}
```

**Notes:**
- Designed for on-demand hydration after reconnects; movement and combat events provide incremental updates between snapshots.
- `sector` reflects the live sector if the character is currently connected; otherwise it falls back to the persisted sector value.

### map.region
**When emitted:** When the `local_map_region` RPC builds a neighborhood snapshot around a sector
**Who receives it:** Only the requesting character (character_filter)
**Source:** `/game-server/api/local_map_region.py`

**Payload example:**
```json
{
  "center_sector": 43,
  "max_hops": 3,
  "total_sectors": 12,
  "sectors": [
    {
      "sector_id": 43,
      "visited": true,
      "position": [100.5, 200.3],
      "port": {"code": "BSB"},
      "adjacent_sectors": [42, 44, 50, 51]
    }
  ],
  "source": {
    "type": "rpc",
    "method": "local_map_region",
    "request_id": "req-region-17",
    "timestamp": "2025-10-16T16:12:00.000Z"
  }
}
```

**Notes:**
- Mirrors the historical response payload so clients can migrate without structural changes.
- Use `max_hops` to infer the breadth of the returned region; clients may request larger windows by increasing the RPC parameter.

### map.local
**When emitted:** When a character needs updated local map data (after movement completion)
**Who receives it:** The character who just moved (character_filter)
**Source:** `/game-server/api/move.py:197`

**Payload example:**
```json
{
  "center_sector": 43,
  "max_hops": 4,
  "sectors": {
    "42": {
      "sector_id": 42,
      "position": [95.2, 198.7],
      "visited": true,
      "port": {
        "code": "SBB",
        "observed_at": "2025-10-07T14:20:00.000Z"
      },
      "planets": []
    },
    "43": {
      "sector_id": 43,
      "position": [100.5, 200.3],
      "visited": true,
      "port": {
        "code": "BSB",
        "observed_at": null
      },
      "planets": []
    },
    "44": {
      "sector_id": 44,
      "position": [105.1, 202.0],
      "visited": false
    }
  },
  "lanes": [
    {"from": 42, "to": 43, "two_way": true, "hyperlane": false},
    {"from": 43, "to": 44, "two_way": true, "hyperlane": false},
    {"from": 43, "to": 50, "two_way": false, "hyperlane": true}
  ]
}
```

## Port Events

### ports.list
**When emitted:** When the `list_known_ports` RPC completes its search
**Who receives it:** Only the requesting character (character_filter)
**Source:** `/game-server/api/list_known_ports.py`

**Payload example:**
```json
{
  "from_sector": 0,
  "ports": [
    {
      "sector_id": 0,
      "hops_from_start": 0,
      "port": {"code": "BSS"},
      "position": [0, 0],
      "last_visited": "2025-10-16T15:00:00.000Z"
    }
  ],
  "total_ports_found": 1,
  "searched_sectors": 1,
  "source": {
    "type": "rpc",
    "method": "list_known_ports",
    "request_id": "req-ports-5",
    "timestamp": "2025-10-16T16:13:00.000Z"
  }
}
```

**Notes:**
- Results are sorted by hop distance from `from_sector`.
- Commodity/trade filters narrow the list to ports that buy or sell the requested commodity in the desired direction.

## Character Events

### character.moved
**When emitted:** When a character moves between sectors (for observers)
**Who receives it:**
- **Departure:** All characters in the old sector (excluding the mover)
- **Arrival:** All characters in the new sector (excluding the mover, not in hyperspace)

**Source:** `/game-server/api/move.py:139` (departure), `/game-server/api/move.py:276` (arrival)

**Payload example (departure):**
```json
{
  "name": "trader",
  "ship_type": "kestrel_courier",
  "timestamp": "2025-10-07T14:25:00.000Z",
  "move_type": "normal",
  "movement": "depart"
}
```

**Payload example (arrival):**
```json
{
  "name": "trader",
  "ship_type": "kestrel_courier",
  "timestamp": "2025-10-07T14:25:02.000Z",
  "move_type": "normal",
  "movement": "arrive"
}
```

**Payload example (teleport via join):**
```json
{
  "name": "trader",
  "ship_type": "kestrel_courier",
  "timestamp": "2025-10-07T14:25:00.000Z",
  "move_type": "teleport",
  "movement": "arrive"
}
```

## Trading Events

### trade.executed
**When emitted:** When a character completes a buy or sell trade at a port
**Who receives it:** The character who executed the trade (character_filter)
**Source:** `/game-server/api/trade.py:167` (buy) and `/game-server/api/trade.py:255` (sell)

**Payload example:**
```json
{
  "source": {
    "type": "rpc",
    "method": "trade",
    "request_id": "req-trade-42",
    "timestamp": "2025-10-16T15:45:12.345678+00:00"
  },
  "ship": {
    "ship_type": "kestrel_courier",
    "ship_name": "Kestrel Courier",
    "cargo": {
      "quantum_foam": 50,
      "retro_organics": 30,
      "neuro_symbolics": 20
    },
    "cargo_capacity": 100,
    "empty_holds": 0,
    "warp_power": 47,
    "warp_power_capacity": 50,
    "shields": 85,
    "max_shields": 100,
    "fighters": 45,
    "max_fighters": 50,
    "credits": 7500
  },
  "player": {
    "created_at": "2025-10-07T12:00:00.000Z",
    "last_active": "2025-10-07T14:26:00.000Z",
    "id": "trader",
    "name": "trader",
    "credits_in_bank": 0
  },
  "trade": {
    "trade_type": "buy",
    "commodity": "quantum_foam",
    "units": 50,
    "price_per_unit": 25,
    "total_price": 1250,
    "new_credits": 7500,
    "new_cargo": {
      "quantum_foam": 50,
      "retro_organics": 30,
      "neuro_symbolics": 20
    },
    "new_prices": {
      "quantum_foam": {"buy_price": null, "sell_price": 25},
      "retro_organics": {"buy_price": 18, "sell_price": null},
      "neuro_symbolics": {"buy_price": 32, "sell_price": null}
    }
  }
}
```

### port.update
**When emitted:** When port inventory/prices change due to trading activity
**Who receives it:** All characters in the sector where the port is located (character_filter)
**Source:** `/game-server/api/trade.py:157` (buy) and `/game-server/api/trade.py:234` (sell)

**Payload example:**
```json
{
  "sector": {"id": 43},
  "updated_at": "2025-10-07T14:26:00.000Z",
  "port": {
    "code": "BSB",
    "prices": {
      "quantum_foam": {"buy_price": null, "sell_price": 13},
      "retro_organics": {"buy_price": 18, "sell_price": null},
      "neuro_symbolics": {"buy_price": null, "sell_price": 25}
    },
    "stock": {
      "quantum_foam": 480,
      "retro_organics": 300,
      "neuro_symbolics": 200
    },
    "observed_at": null
  }
}
```

## Warp Power Events

### warp.purchase
**When emitted:** When a character purchases warp power at sector 0 depot
**Who receives it:** The character who purchased warp power (character_filter)
**Source:** `/game-server/api/recharge_warp_power.py:70`

**Payload example:**
```json
{
  "source": {
    "type": "rpc",
    "method": "recharge_warp_power",
    "request_id": "req-warp-123",
    "timestamp": "2025-10-16T14:27:00.000Z"
  },
  "character_id": "trader",
  "sector": {"id": 0},
  "units": 25,
  "price_per_unit": 2,
  "total_cost": 50,
  "timestamp": "2025-10-07T14:27:00.000Z",
  "new_warp_power": 175,
  "warp_power_capacity": 300,
  "new_credits": 950
}
```

### warp.transfer
**When emitted:** When warp power is transferred between two characters via `/api/transfer_warp_power`.
**Who receives it:** Sender and receiver each receive their own copy with appropriate `transfer_direction`.
**Source:** `/game-server/api/transfer_warp_power.py`

**Privacy:** Warp power levels are not included for privacy reasons. Each player receives their updated warp power via a `status.update` event immediately after the transfer.

**Direction:** Each participant receives their own copy of the event with `transfer_direction` set to either `"sent"` or `"received"`.

**Payload example (sender's view):**
```json
{
  "transfer_direction": "sent",
  "transfer_details": {
    "warp_power": 10
  },
  "from": {
    "created_at": "2025-10-07T14:00:00.000Z",
    "id": "trader",
    "name": "Helpful Trader",
    "player_type": "human",
    "ship": {
      "ship_type": "atlas_hauler",
      "ship_name": "Heavy Freighter"
    }
  },
  "to": {
    "created_at": "2025-10-07T14:15:00.000Z",
    "id": "merchant",
    "name": "Local Merchant",
    "player_type": "human",
    "ship": {
      "ship_type": "kestrel_courier",
      "ship_name": "Fast Courier"
    }
  },
  "sector": {"id": 43},
  "timestamp": "2025-10-07T14:28:00.000Z",
  "source": {
    "type": "rpc",
    "method": "transfer_warp_power",
    "request_id": "req-transfer-987",
    "timestamp": "2025-10-07T14:28:00.000Z"
  }
}
```

**Payload example (receiver's view):**
```json
{
  "transfer_direction": "received",
  "transfer_details": {
    "warp_power": 10
  },
  "from": { /* same as above */ },
  "to": { /* same as above */ },
  "sector": {"id": 43},
  "timestamp": "2025-10-07T14:28:00.000Z",
  "source": { /* same as above */ }
}
```

## Credit & Banking Events

### credits.transfer
**When emitted:** When one character sends on-hand credits to another character in the same sector via `/api/transfer_credits`.
**Who receives it:** Sender and receiver each receive their own copy with appropriate `transfer_direction`.
**Source:** `/game-server/api/transfer_credits.py`

**Privacy:** Balance information is not included for privacy reasons. Each player receives their updated balance via a `status.update` event immediately after the transfer.

**Direction:** Each participant receives their own copy of the event with `transfer_direction` set to either `"sent"` or `"received"`.

**Payload example (sender's view):**
```json
{
  "transfer_direction": "sent",
  "transfer_details": {
    "credits": 500
  },
  "from": {
    "created_at": "2025-10-19T04:00:00.000Z",
    "id": "helper_pilot",
    "name": "Generous Trader",
    "player_type": "human",
    "ship": {
      "ship_type": "kestrel_courier",
      "ship_name": "The Philanthropist"
    }
  },
  "to": {
    "created_at": "2025-10-19T04:10:00.000Z",
    "id": "newbie_trader",
    "name": "Grateful Newbie",
    "player_type": "human",
    "ship": {
      "ship_type": "sparrow_scout",
      "ship_name": "Lucky Scout"
    }
  },
  "sector": {"id": 43},
  "timestamp": "2025-10-19T04:02:05.120Z",
  "source": {
    "type": "rpc",
    "method": "transfer_credits",
    "request_id": "req-credits-19",
    "timestamp": "2025-10-19T04:02:05.120Z"
  }
}
```

**Payload example (receiver's view):**
```json
{
  "transfer_direction": "received",
  "transfer_details": {
    "credits": 500
  },
  "from": { /* same as above */ },
  "to": { /* same as above */ },
  "sector": {"id": 43},
  "timestamp": "2025-10-19T04:02:05.120Z",
  "source": { /* same as above */ }
}
```

### bank.transaction
**When emitted:** Whenever a deposit or withdrawal completes at the sector 0 bank via `/api/bank_transfer`.
**Who receives it:** Only the initiating character.
**Source:** `/game-server/api/bank_transfer.py`

**Payload example:**
```json
{
  "source": {
    "type": "rpc",
    "method": "bank_transfer",
    "request_id": "req-bank-02",
    "timestamp": "2025-10-19T05:44:00.000Z"
  },
  "character_id": "sector0_runner",
  "sector": {"id": 0},
  "direction": "deposit",
  "amount": 2000,
  "timestamp": "2025-10-19T05:44:00.000Z",
  "ship_credits_before": 5600,
  "ship_credits_after": 3600,
  "credits_in_bank_before": 0,
  "credits_in_bank_after": 2000
}
```


## Ship Purchase Events

### ship.traded_in
**When emitted:** When a character trades in their current ship for a new one at sector 0
**Who receives it:** Only the character making the purchase (character_filter - private)
**Source:** `/game-server/api/ship_purchase.py`

**Payload example:**
```json
{
  "character_id": "trader",
  "old_ship_id": "uuid-old-ship",
  "old_ship_type": "kestrel_courier",
  "new_ship_id": "uuid-new-ship",
  "new_ship_type": "atlas_hauler",
  "trade_in_value": 15000,
  "price": 50000,
  "net_cost": 35000,
  "timestamp": "2025-11-01T16:00:00.000Z"
}
```

**Notes:**
- **Private event:** Only buyer sees it (financial transaction privacy)
- **Trade-in required:** Cannot own multiple personal ships; must trade in current ship
- Old ship is marked as `unowned` and becomes a derelict
- Character receives `status.update` immediately after with new ship and credits
- `net_cost` = price - trade_in_value (can be negative if downgrading)
- Balance information not included; clients receive updated balances via `status.update`

## Corporation Events

### corporation.ship_purchased
**When emitted:** When a corporation member purchases a ship on behalf of their corporation
**Who receives it:** All corporation members (character_filter)
**Source:** `/game-server/api/ship_purchase.py`

**Payload example:**
```json
{
  "corp_id": "corp-uuid-123",
  "ship_id": "uuid-corp-ship",
  "ship_type": "pike_frigate",
  "ship_name": "Corporate Asset One",
  "purchase_price": 100000,
  "buyer_id": "member-uuid",
  "buyer_name": "Fleet Admiral",
  "sector": 0,
  "timestamp": "2025-11-01T16:05:00.000Z"
}
```

**Notes:**
- **Member broadcast:** All corp members receive notification
- **Buyer pays from bank:** Credits drawn from buyer's `credits_in_bank` (not shared corp treasury)
- **Corp ownership:** Ship owned by corporation (`owner_type: "corporation"`)
- **Cannot trade in:** Corp ships cannot be traded in, only purchased fresh
- Each member receives `status.update` reflecting buyer's bank balance change
- Balance information not included for privacy; clients track via `status.update`

### corporation.created
**When emitted:** When a character creates a new corporation
**Who receives it:** Only the founder (character_filter - private)
**Source:** `/game-server/api/corporation_create.py`
**Status:** *(Implemented in Phase 1)*

### corporation.member_joined
**When emitted:** When a character joins a corporation using an invite code
**Who receives it:** All corporation members (character_filter)
**Source:** `/game-server/api/corporation_join.py`
**Status:** *(Implemented in Phase 1)*

### corporation.member_left
**When emitted:** When a member voluntarily leaves a corporation
**Who receives it:** Remaining corporation members (character_filter)
**Source:** `/game-server/api/corporation_leave.py`
**Status:** *(Implemented in Phase 1)*

### corporation.member_kicked
**When emitted:** When a member is kicked from a corporation
**Who receives it:** All remaining members plus the kicked member (character_filter)
**Source:** `/game-server/api/corporation_kick.py`
**Status:** *(Implemented in Phase 1)*
**Notes:** Logged with `corporation_id` even when the member is offline; the player will receive it on reconnect via WebSocket replay or by querying the event log.

### corporation.invite_code_regenerated
**When emitted:** When a member regenerates the corporation's invite code
**Who receives it:** All corporation members (character_filter)
**Source:** `/game-server/api/corporation_regenerate_invite_code.py`
**Status:** *(Implemented in Phase 1)*

### corporation.disbanded
**When emitted:** When the last member leaves a corporation
**Who receives it:** The leaving member (character_filter)
**Source:** `/game-server/api/corporation_leave.py`
**Status:** *(Implemented in Phase 1)*

### corporation.ships_abandoned
**When emitted:** When a corporation disbands and has ships to abandon
**Who receives it:** The leaving member (character_filter)
**Source:** `/game-server/api/corporation_leave.py`
**Status:** *(Implemented in Phase 1)*

**Notes on corporation events:**
- All corp events include `corporation_id` in their `EventLogContext` for queryability
- Invite codes are only revealed to corporation members
- Corp events support multi-character fanout (all members notified simultaneously)
- Offline members receive the next `corporation.*` event as soon as they reconnect (events are persisted and can be fetched via `event.query`).
- See `planning-files/corporations_implementation.md` for complete specifications

## Status Events

### status.snapshot
**When emitted:** When a player successfully calls the `my_status` or `join` RPC
**Who receives it:** Only the requesting character (character_filter)
**Source:** `/game-server/api/my_status.py`, `/game-server/api/join.py`

**Payload example:**
```json
{
  "source": {
    "type": "rpc",
    "method": "my_status",
    "request_id": "req-123",
    "timestamp": "2025-10-16T15:32:18.000Z"
  },
  "player": {
    "created_at": "2025-10-16T14:20:00.000Z",
    "last_active": "2025-10-16T15:32:18.000Z",
    "id": "explorer",
    "name": "explorer",
    "credits_in_bank": 0
  },
  "ship": {
    "ship_type": "kestrel_courier",
    "ship_name": "Kestrel Courier",
    "cargo": {
      "quantum_foam": 45,
      "retro_organics": 12,
      "neuro_symbolics": 4
    },
    "cargo_capacity": 120,
    "empty_holds": 59,
    "warp_power": 38,
    "warp_power_capacity": 50,
    "shields": 120,
    "max_shields": 150,
    "fighters": 45,
    "max_fighters": 50,
    "credits": 1200
  },
  "sector": {
    "id": 17,
    "adjacent_sectors": [12, 16, 18, 21],
    "port": null,
    "players": [],
    "garrison": null,
    "salvage": [],
    "unowned_ships": []
  },
  "corporation": {
    "corp_id": "corp_d4f7",
    "name": "Surveyors Guild",
    "member_count": 6,
    "joined_at": "2025-10-10T09:00:00.000Z"
  }
}
```

**Notes:**
- `corporation` is omitted (`null`) when the viewer is not in a corp.
- Correlation metadata in `source` mirrors the originating RPC frame (`my_status` or `join`) so clients can reconcile queued actions.
- Payload structure matches `status.update`; clients can treat both events interchangeably for state hydration.
- Payload structure matches `status.update`; clients can treat both events interchangeably for state hydration.

### status.update
**When emitted:** When a character's status changes (after combat rounds, trades, warp purchases, fighter collection, etc.)
**Who receives it:** The specific character whose status changed (character_filter)
**Source:**
- `/game-server/combat/callbacks.py:60` (after combat rounds)
- `/game-server/api/recharge_warp_power.py:92` (after warp purchase)
- `/game-server/api/transfer_warp_power.py:84` (after warp transfer)
- Multiple other locations after state-changing operations

**Payload example:**
```json
{
  "player": {
    "created_at": "2025-10-07T12:00:00.000Z",
    "last_active": "2025-10-07T14:28:30.000Z",
    "id": "trader",
    "name": "trader",
    "credits_in_bank": 0
  },
  "ship": {
    "ship_type": "kestrel_courier",
    "ship_name": "Kestrel Courier",
    "cargo": {
      "quantum_foam": 50,
      "retro_organics": 30,
      "neuro_symbolics": 20
    },
    "cargo_capacity": 100,
    "empty_holds": 0,
    "warp_power": 37,
    "warp_power_capacity": 50,
    "shields": 85,
    "max_shields": 100,
    "fighters": 45,
    "max_fighters": 50,
    "credits": 14350
  },
  "sector": {
    "id": 43,
    "adjacent_sectors": [42, 44, 50, 51],
    "port": {
      "code": "BSB",
      "prices": {
        "quantum_foam": {"buy_price": null, "sell_price": 13},
        "retro_organics": {"buy_price": 18, "sell_price": null},
        "neuro_symbolics": {"buy_price": null, "sell_price": 25}
      },
      "stock": {
        "quantum_foam": 480,
        "retro_organics": 300,
        "neuro_symbolics": 200
      },
      "observed_at": null
    },
    "players": [
      {
        "created_at": "2025-10-07T11:00:00.000Z",
        "name": "merchant",
        "player_type": "human",
        "ship": {
          "ship_type": "atlas_freighter",
          "ship_name": "Atlas Freighter"
        }
      }
    ],
    "garrison": null,
    "salvage": []
  }
}
```

## Sector Events

### sector.update
**When emitted:** When sector contents change (salvage collected, combat ended)
**Who receives it:** All characters in the affected sector (character_filter)
**Source:**
- `/game-server/api/salvage_collect.py:64` (after salvage collection)
- `/game-server/combat/callbacks.py:380` (after combat ended)

**Payload example:**
```json
{
  "id": 42,
  "adjacent_sectors": [41, 43, 49, 50],
  "port": null,
  "players": [
    {
      "created_at": "2025-10-07T11:30:00.000Z",
      "name": "pirate",
      "player_type": "human",
      "corporation": {
        "name": "Sector Corps"
      },
      "ship": {
        "ship_type": "sparrow_scout",
        "ship_name": "Sparrow Scout"
      }
    }
  ],
  "garrison": null,
  "salvage": [
    {
      "salvage_id": "salv_xyz789",
      "created_at": "2025-10-07T14:24:00.000Z",
      "expires_at": "2025-10-07T14:39:00.000Z",
      "cargo": {
        "retro_organics": 25
      },
      "scrap": 20,
      "credits": 0,
      "claimed": false,
      "source": {
        "ship_name": "Unknown Ship",
        "ship_type": "kestrel_courier"
      },
      "metadata": {
        "combat_id": "example-combat"
      }
    }
  ],
  "unowned_ships": []
}
```

**Notes:**
- Emitted whenever sector contents change (combat resolution, salvage collection, garrison deployment/removal, toll payment).
- Each entry in `players` includes `corporation.name` when available (omitted when unaffiliated).
- When `garrison` is present, it contains `is_friendly`, which is `true` for the owner and any corp mates.
- `unowned_ships` lists visible derelict hulls (`owner_type` = `"unowned"`) so clients can surface claim/salvage actions.
- Multiple `sector.update` events can be emitted in quick succession; clients should treat the payload as authoritative for the sector.

## Event Filter Summary

Most events use `character_filter` to target specific characters:

- **Broadcast (no filter):** _None (all current events target specific recipients)_
- **Single character:** `movement.start`, `movement.complete`, `map.local`, `trade.executed`, `warp.purchase`, `status.update`
- **Multiple specific characters:** `warp.transfer` (sender + receiver), `status.update` (after combat to all participants)
- **Sector observers (excluding actor):** `character.moved` (observers in old/new sectors)
- **Sector observers (all):** `port.update`, `sector.update`
- **Combat participants:** `combat.round_waiting`, `combat.round_resolved`, `combat.ended`

## Privacy Considerations

The new combat event serialization (implemented in `/game-server/combat/utils.py`) is privacy-aware:
- Combat events show ship names and shield percentages, but not exact fighter counts
- Cargo and credit information is never revealed to opponents
- Character IDs are shown for ownership but player display names can be different
- Garrison details (mode, toll) are revealed to participants in combat with that garrison
- `ship.empty_holds` is a calculated convenience field (cargo_capacity - sum(cargo)) included only in events containing the viewer's own ship status (via `ship_self()`), never in public player views (sector.update, character.moved) or opponent combat data

**Ship purchase and corporation event privacy:**
- `ship.traded_in` is private to buyer only (financial transaction)
- `corporation.ship_purchased` is broadcast to all corp members only
- Purchase events do not include before/after balance information
- Clients receive balance updates via separate `status.update` events
- Corporation events are filtered by membership (only members receive corp-specific events)
- Invite codes are only revealed in events sent to corporation members
